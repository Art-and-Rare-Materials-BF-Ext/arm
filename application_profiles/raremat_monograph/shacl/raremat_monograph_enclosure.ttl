@prefix aat: <http://vocab.getty.edu/aat/> .
@prefix activity: <https://w3id.org/arm/core/activity/0.1/> .
@prefix arm: <https://w3id.org/arm/core/ontology/0.1/> .
@prefix bf: <http://id.loc.gov/ontologies/bibframe/> .
@prefix crm: <http://www.cidoc-crm.org/Property/P2-has-type/Version-6.2/> .
@prefix dcterms: <http://purl.org/dc/terms/> .
@prefix owl: <http://www.w3.org/2002/07/owl#> .
@prefix rdf: <http://www.w3.org/1999/02/22-rdf-syntax-ns#> .
@prefix rdfs: <http://www.w3.org/2000/01/rdf-schema#> .
@prefix sh: <http://www.w3.org/ns/shacl#> .
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .
@prefix swa: <http://topbraid.org/swa#> .
@prefix tosh: <http://topbraid.org/tosh#> .
@prefix xsd: <http://www.w3.org/2001/XMLSchema#> .

@prefix : <https://w3id.org/arm/application_profiles/raremat_monograph/shacl/raremat_monograph_enclosure/> .
@prefix arm_core_property_shapes: <https://w3id.org/arm/core/validation/shacl/arm_core_property_shapes/> .
@prefix raremat_monograph_activity: <https://w3id.org/arm/application_profiles/raremat_monograph/shacl/raremat_monograph_activity/> .
@prefix raremat_monograph_form: <https://w3id.org/arm/application_profiles/raremat_monograph/shacl/raremat_monograph_form/> .
@prefix raremat_monograph_marking: <https://w3id.org/arm/application_profiles/raremat_monograph/shacl/raremat_monograph_marking/> .
@prefix raremat_monograph_material: <https://w3id.org/arm/application_profiles/raremat_monograph/shacl/raremat_monograph_material/> .
@prefix raremat_monograph_note: <https://w3id.org/arm/application_profiles/raremat_monograph/shacl/raremat_monograph_note/> .
@prefix raremat_monograph_property_groups: <https://w3id.org/arm/application_profiles/shacl/raremat_monograph_property_groups/> . 


# Generic PropertyShape linking a resource to an Enclosure. Specific
# constraints are added in InstanceForm:bf_hasPart_arm_Enclosure and 
# ItemForm:bf_hasPart_arm_Enclosure.
:bf_hasPart_arm_Enclosure
    sh:and (
        arm_core_property_shapes:bf_hasPart
        [
            sh:class arm:Enclosure ;
            # NON-VALIDATING   
            # NB Binding has some fields that don't apply to all Enclosures,
            # so defined a Binding-specific form shape below, and using this 
            # for non-Binding Enclosures, thus use of "Other" in the name.
            sh:name "Other enclosure" ; 
            tosh:editWidget swa:NestedObjectEditor ;             
        ]
    ) ;
    .

# Links Instance to Enclosure. Note that Instance and Item use different
# PropertyShapes because they belong to different property groups. The need
# for different property groups is that properties need to be ordered
# differently for Instance and Items.
:InstanceForm_bf_hasPart_arm_Enclosure
    sh:and (
        :bf_hasPart_arm_Enclosure
        [
            # NON-VALIDATING 
            sh:group raremat_monograph_property_groups:InstancePhysicalDescriptionPropertyGroup ;   
            sh:order "0"^^xsd:decimal ;             
        ]
    ) ;
    .

# Links Instance to Enclosure. Note that Instance and Item use different
# PropertyShapes because they belong to different property groups. The need
# for different property groups is that properties need to be ordered
# differently for Instance and Items.
:ItemForm_bf_hasPart_arm_Enclosure
    sh:and (
        :bf_hasPart_arm_Enclosure
        [          
            # NON-VALIDATING 
            sh:group raremat_monograph_property_groups:ItemPhysicalDescriptionPropertyGroup ;   
            sh:order "0"^^xsd:decimal ;             
        ]
    ) ;
    .
    
:EnclosureForm
    a sh:NodeShape ;
    rdfs:label "Enclosure" ;
    sh:targetClass arm:Enclosure ;
    sh:property
        :EnclosureForm_activity_hasActivity ,
        # Uses general Material form shape, no special constraints needed.
        # (Though conceivably in the future we would want to identify
        # materials relevant only to enclosures).
        raremat_monograph_material:arm_hasMaterial ,  
        # Uses general Marking form shape, no special constraints needed
        raremat_monograph_marking:arm_markedBy ,
        :EnclosureForm_bf_note ,   
        :EnclosureForm_rdf_type ;
    .
    
##### ENCLOSURE ACTIVITY #####

:EnclosureForm_activity_hasActivity
    sh:and (
        arm_core_property_shapes:activity_hasActivity 
        [
            # NON-VALIDATING
            sh:name "Agent" ;
            sh:description "Agent related to the Enclosure: binder, designer, creator, etc." ;
            sh:group raremat_monograph_property_groups:ActivityPropertyGroup ;
            sh:order "0"^^xsd:decimal ;
            tosh:editWidget swa:NestedObjectEditor ;       
        ]
    ) ;
    .
    
:EnclosureActivityForm
    sh:and (
        raremat_monograph_activity:ActivityForm
        [
            sh:property :EnclosureActivityForm_rdf_type ;        
        ]
    ) ;     
    .
 
:EnclosureActivityForm_rdf_type 
    sh:and (
        arm_core_property_shapes:rdf_type 
        [
            sh:in (
                # TODO Check this list with catalogers
                # BinderActivity attaches to both Item and Binding, but
                # we will ignore that for now and attach only to the
                # Binding.
                arm:BinderActivity
                arm:CreatorActivity
                arm:DesignerActivity
                arm:EngraverActivity
                arm:MarblerActivity
                arm:PapermakerActivity               
            ) ;       
            # NON-VALIDATING
            sh:name "Activity type" ;    
            sh:order "0"^^xsd:decimal ;  
        ]
    ) ;
    .  


##### ENCLOSURE NOTE #####

:EnclosureForm_bf_note
    sh:and (
        arm_core_property_shapes:bf_note 
        [       
            # NON-VALIDATING
            sh:name "Enclosure note" ; 
            sh:description "Additional textual notes about this enclosure." ;     
            sh:order "0"^^xsd:decimal ;   
            tosh:editWidget swa:NestedObjectEditor ;
        ]
    ) ;
    .

:EnclosureNoteForm
    sh:and (
        raremat_monograph_note:NoteForm
        [
            sh:property :EnclosureNoteForm_rdf_type ;        
        ]
    ) ;     
    .
 
:EnclosureNoteForm_rdf_type 
    sh:and (
        arm_core_property_shapes:rdf_type 
        [
            sh:in (
                arm:DescriptiveNote
                bf:Note
            ) ;
            # NON-VALIDATING
            sh:name "Note type" ;    
            sh:order "0"^^xsd:decimal ;       
        ]
    ) ;
    . 

##### ENCLOSURE TYPE #####

:EnclosureForm_crm_P2_has_type # + vocab 
    sh:and (
        arm_core_property_shapes:crm_P2_has_type
        [
            # NON-VALIDATING
            sh:name "Specific enclosure type, such as boards, " ;
            sh:order "0"^^xsd:decimal ;   
        ]
    ) ;
    .

:EnclosureForm_rdf_type 
    sh:and (
        arm_core_property_shapes:rdf_type
        [
            sh:in (
                # Removing here since created separate Binding form shape
                # arm:Binding
                arm:DustJacket
                arm:SlipCase
                arm:WrapAroundBand
                arm:Wrapper
                arm:Enclosure
            ) ;
            # NON-VALIDATING
            sh:name "General type of enclosure" ;
        ]
    ) ;
    .


##### BINDING-SPECIFIC SHAPES #####

# Generic PropertyShape linking a resource to an Enclosure. Specific
# constraints added in InstanceForm:bf_hasPart_arm_Enclosure and 
:bf_hasPart_arm_Binding
    sh:and (
        arm_core_property_shapes:bf_hasPart
        [
            sh:class arm:Binding ;
            # NON-VALIDATING   
            sh:name "Binding" ;  
            tosh:editWidget swa:NestedObjectEditor ;           
        ]
    ) ;
    .
    
:InstanceForm_bf_hasPart_arm_Binding
    sh:and (
        :bf_hasPart_arm_Binding
        [
            sh:group raremat_monograph_property_groups:InstancePhysicalDescriptionPropertyGroup ;   
            sh:order "0"^^xsd:decimal ;               
        ]
    ) ;
    .
    
:ItemForm_bf_hasPart_arm_Binding
    sh:and (
        :bf_hasPart_arm_Binding
        [
            sh:group raremat_monograph_property_groups:ItemPhysicalDescriptionPropertyGroup ;   
            sh:order "0"^^xsd:decimal ;               
        ]
    ) ;
    .
    
       
:BindingForm
    a sh:NodeShape ;
    rdfs:label "Binding" ;
    sh:targetClass arm:Binding ;
    sh:property
        :EnclosureForm_activity_hasActivity ,
        # TODO Or should we create a Binding-specific shape for 
        # arm:hasMaterial that specifies the RBMS binding vocab?
        raremat_monograph_material:arm_hasMaterial ,  
        # Uses general MarkingForm, no special constraints needed
        raremat_monograph_marking:arm_markedBy ,
        :EnclosureForm_bf_note ,   
        # TODO Add RBMS terms converted to RDF
        # :BindingForm_crm_P2_has_type ,   
        :BindingForm_bf_hasPart ; 
    .

##### BINDING COMPONENT #####

:BindingForm_bf_hasPart 
    sh:and (
        arm_core_property_shapes:bf_hasPart
        [
            sh:in (
                # Getty AAT binding components: http://vocab.getty.edu/page/aat/300194225
                aat:300261522
                aat:300253047
                aat:300261776
                aat:300312358
                aat:300202819
                aat:300263630
                aat:300253051
                aat:300253057
                aat:300263628
                aat:300195163
                aat:300263627
                aat:300195149
                aat:300209357
                aat:300083023
                aat:300263593
                aat:300263626
                aat:300195150
                aat:300263618
                aat:300248893
                aat:300195163
                aat:300261765
                aat:300263629
                aat:300261769
                aat:300410465
                aat:300263625
                aat:300252986
                aat:300261564
                aat:300208775
                aat:300263631
                aat:300253125
                aat:300253099
                aat:300253096
                aat:300261780
                aat:300263632
                aat:300253949       
            ) ;
            # NON-VALIDATING
            sh:name "Binding component" ;
            sh:description "Part of the binding, such as binding board, headband, bead, finishing hardware, etc." ;
            sh:order "0"^^xsd:decimal ;   
        ]
    ) ;
    . 
    